<!DOCTYPE html>
<html lang="en">

<head>
    <title>Admin Panel</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" type="image/png" href="images/icons/favicon.ico" />

    <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">

    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">

    <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">

    <link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">

    <link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">

    <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">

    <link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">

    <link rel="stylesheet" type="text/css" href="css/util.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">

    <meta name="robots" content="noindex, follow">
</head>

<body>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Modal</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
      	<div class="container">
<center>
  <h1>Edit Products</h1>
</center>
<div class="mb-3">
  <label for="EditName" class="form-label">Product Name</label>
  <input type="email" class="form-control" id="EditName" placeholder="Example:- Mobile, Computer">
</div>
<div class="mb-3">
  <label for="EditPrice" class="form-label">Product Price</label>
  <input type="tel" class="form-control" id="EditPrice" placeholder="Example:- 100">
</div>
<div class="mb-3" >
  <img src=""	style="width:200px; height:200px;" id="EditFilePreview"></img>
</div>
<button type="button" id="EditBtn" class="btn btn-primary ">Edit</button>
</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

    <div class="limiter" style="display:block;" id="loginSection">
        <div class="container-login100">
            <div class="wrap-login100">
                <form class="login100-form validate-form" action="#">
                    <span class="login100-form-title p-b-26">
Welcome
</span>
                    <span class="login100-form-title p-b-48">
<i class="zmdi zmdi-font"></i>
</span>
                    <div class="wrap-input100 validate-input">
                        <input class="input100" id="mobileNumber" type="tel" >
                        <span class="focus-input100" data-placeholder="Mobile Number"></span>
                    </div>
                    <div class="wrap-input100 validate-input" data-validate="Enter password">
                        <span class="btn-show-pass">
<i class="zmdi zmdi-eye"></i>
</span>
                        <input class="input100" id="password" type="password" name="pass">
                        <span class="focus-input100" data-placeholder="Password"></span>
                    </div>
                    <div class="container-login100-form-btn">
                        <div class="wrap-login100-form-btn">
                            <div class="login100-form-bgbtn"></div>
                            <button class="login100-form-btn" id="submitBtn">
											Login
							</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="dropDownSelect1"></div>
	
	<div id="AdminPanel" style="display:none;">
	
	<div class="container">
<center>
  <h1>Add Products</h1>
</center>
<div class="mb-3">
  <label for="ProductName" class="form-label">Product Name</label>
  <input type="email" class="form-control" id="ProductName" placeholder="Example:- Mobile, Computer">
</div>
<div class="mb-3">
  <label for="ProductPrice" class="form-label">Product Price</label>
  <input type="tel" class="form-control" id="ProductPrice" placeholder="Example:- 100">
</div>
<div class="mb-3">
  <label for="ProductFile" class="form-label">Product Image</label>
  <input type="file" class="form-control" id="ProductFile" >
</div>
<button type="button" id="ProductAddBtn" class="btn btn-primary ">Add</button>
</div>
</div>

<div class="container">
<center>
<h1>All Product's See Here..</h1>
</center>

<div id="ProductPage" style="display:flex; flex-wrap:wrap;">

</div>

</div>
	
	</div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
 

   <script type="module">
   let base64Image
   // Selecting DOM elements
const AdminPanel = document.querySelector("#AdminPanel");
const loginSection = document.querySelector("#loginSection");
const submitButton = document.querySelector("#submitBtn");
const ProductName = document.getElementById("ProductName");
const ProductPrice = document.getElementById("ProductPrice");
const ProductFile = document.getElementById("ProductFile");
const ProductAddBtn = document.getElementById("ProductAddBtn");
const ProductPage = document.getElementById("ProductPage");
const imageInput = document.getElementById('ProductFile');

// Firebase imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
import { getDatabase, ref, onValue, remove, set, push, update } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

// Firebase configuration
  const firebaseConfig = {
  apiKey: "AIzaSyD1Fv2mgRJkzf66lYiGt7-tkDK7winppsI",
  authDomain: "shiv-computer-b911c.firebaseapp.com",
  databaseURL: "https://shiv-computer-b911c-default-rtdb.firebaseio.com",
  projectId: "shiv-computer-b911c",
  storageBucket: "shiv-computer-b911c.appspot.com",
  messagingSenderId: "526120095986",
  appId: "1:526120095986:web:6d406d10bbf3939a99806b",
  measurementId: "G-GGHW0ZYXNH"
  };

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const database = getDatabase(app);

// Event listener for submit button
submitButton.addEventListener("click", async function (e) {
  e.preventDefault();
  const mobileNumber = document.getElementById("mobileNumber").value + "@gmail.com";
  const password = document.getElementById("password").value;

  try {
    const userCredential = await signInWithEmailAndPassword(auth, mobileNumber, password);
    const user = userCredential.user;
    console.log("Success! Welcome back!");
    alert("Login Successfully! Welcome back!");
  

 loginSection.style.display = "none";
    AdminPanel.style.display = "block";

    // Local storage for the uploaded image
    imageInput.addEventListener("change", function () {
      if (imageInput.files.length > 0) {
        const file = imageInput.files[0];
        const reader = new FileReader();
        reader.onload = function (e) {
          base64Image = e.target.result;
          localStorage.setItem('storedImage', base64Image);
        };
        reader.readAsDataURL(file);
      } else {
        alert('Please select an image.');
      }
    });

    // Function to submit the form
    function submitForm(e) {
      e.preventDefault();
      const Name = ProductName.value;
      const Price = ProductPrice.value;
      let Image = base64Image

      if (Name && Price) {
        const usersRef = push(ref(database, "Products"));
        set(usersRef, {
          ProductName: Name,
          ProductPrice: Price,
          ProductImage: base64Image
        }).then(() => {
          alert("Product Added Successfully");
          localStorage.clear();
        }).catch((error) => {
          alert("Product Not Added", error);
        });
      } else {
        alert("Please enter both a Name and a Price.");
      }
    }

    ProductAddBtn.addEventListener("click", submitForm);

    let UserName = "Products";
    onValue(ref(database, UserName), (snapshot) => {
      ProductPage.innerHTML = ""; // Clear the previous content

      snapshot.forEach((childSnapshot) => {
        const childData = childSnapshot.val();
        const Name = childData.ProductName;
        const Price = childData.ProductPrice;
        const Image = childData.ProductImage;
        const documentId = childSnapshot.key;

        // Display data in the HTML
        ProductPage.innerHTML += `
          <div class="card my-3 mx-3" style="width: 18rem;">
            <img src="${Image}" class="card-img-top" alt="">
            <div class="card-body">
              <h5 class="card-title">${Name}</h5>
              <h2 class="card-text">${Price}</h2>
              <a href="#" class="btn btn-danger" data-document-id="${documentId}" id="delBtn">Delete</a>
              <a href="#" class="btn btn-success" data-document-id="${documentId}" id="editBtn"   data-bs-toggle="modal" data-bs-target="#exampleModal">Edit</a>
            </div>
          </div>
        `;
      });

      // Event listener for delete buttons
      const deleteButtons = document.querySelectorAll("#delBtn");
      deleteButtons.forEach((btn) => {
        btn.addEventListener("click", (event) => {
          const documentIdToDelete = event.target.getAttribute("data-document-id");
          if (documentIdToDelete) {
            const documentRefToDelete = ref(database, `${UserName}/${documentIdToDelete}`);
            deleteDoc(documentRefToDelete);
          }
        });
      });

      // Event listener for edit buttons
      const editButtons = document.querySelectorAll("#editBtn");
      editButtons.forEach((btn) => {
        btn.addEventListener("click", (event) => {
          const documentIdToEdit = event.target.getAttribute("data-document-id");
          if (documentIdToEdit) {
             let ProductRef = ref(database, `Products/${documentIdToEdit}`);
			
				let EditName = document.getElementById("EditName")
				let EditPrice = document.getElementById("EditPrice")
				let EditBtn = document.getElementById("EditBtn");
				let EditFilePreview = document.getElementById("EditFilePreview");
		
			 onValue(ProductRef, (snapshot)=>{
			    let data = snapshot.val();
				
				EditName.value = data.ProductName;
				EditPrice.value = data.ProductPrice;
				EditFilePreview.src = data.ProductImage;
				
			 })
			 
			 
			  let EName = EditName.value;
				 let EPrice = EditPrice.value;
				 
			 
			  const editBtn = document.getElementById("EditBtn");
        EditBtn.addEventListener('click', async () => {
		
          await update(ref(database, `Products/${documentIdToEdit}`), {
            ProductName: EditName.value,
            ProductPrice: EditPrice.value
          });
          alert("Product Edit successfully");
		   localStorage.clear();
        });
      
		  }
		  else{
		    alert("find some error");
		  }
        });
      });
    });	

    // Function to delete a document
    async function deleteDoc(docRef) {
      try {
        await remove(docRef);
        alert("Document successfully deleted!");
      } catch (error) {
        console.error("Document deletion unsuccessful. Please try again!");
      }
    }

   
  } catch (error) {
    alert("Login Error"+error);
    console.error(error);
  }
}); 
   </script>
	

  
 
</body>

</html>